\documentclass{article}

\usepackage{fontspec}
\usepackage[hyphens]{url}
\usepackage[hidelinks]{hyperref}
\usepackage[normalem]{ulem}
\usepackage{siunitx}
\usepackage{graphicx}
\setmainfont{TeX Gyre Pagella}
\newcommand{\Vcc}{$V_{cc}$}
\newcommand{\Vout}{$V_{out}$}
\newcommand{\Vref}{$V_{ref}$}
\newcommand{\chippin}{\texttt}
\newcommand{\model}{\textsf}

\begin{document}
\frenchspacing % make smaller spaces between sentences
\section{About This Document}
This is my attempt to understand how the DC power board in the Game
Gear works. It started as just an attempt to find out how much current
I could safely draw from the power rails, and my curiosity grew it
into an entire discussion of the power board.

To prevent confusion, I have not explained pieces of the circuit I
don't understand (though there is one exception, Section
\ref{sec:l1_and_5v}). See Section \ref{sec:remaining_questions} for
these questions as well as functionality I haven't tested.

This document is not meant to stand alone. It is intended to be used
alongside a schematic of the power board, in particular the
\model{VA1} schematic. While you could also use the \model{VA0}
schematic, it is harder to read, being hand-drawn, and has some
components that were removed on the \model{VA1} schematic.

It may also be helpful to have the \model{MB3775} datasheet at hand,
as the chip is the heart of this entire board and I reference its
datasheet frequently. See Section \ref{sec:documents} for URLs for
schematics and datasheets.

In this document, IC pins and model numbers are \chippin{typeset like
  this}, components, voltages and currents are $typeset_{like this}$,
and model numbers are \model{typeset like this}.

I try to explain everything in as much depth as I reasonably
can. However, you will need to understand how transistors work (and
what they do to current), as well as have a moderate understanding of
electronics in general. Depending on your level of knowledge or your
goal, you can skip parts too. For example, if you're trying to design
something that draws power from the console's power rails, you could
probably skip to Section \ref{sec:current_draw} and ignore most of the
electrical explanation.

If you use information from this document in a project, please credit
me and this document, and if possible, add a link to the GitHub
repository (\url{https://github.com/liamhays/game-gear-power-docs}).

I claim no responsibility if you try to modify your console, tap a
power line, or something else completely, and your handheld releases
the magic blue smoke. Be careful!

\section{Introduction}
The Game Gear has to supply 5 volt and 34 volt DC, all from a set of
six AA batteries or a DC wall wart, \textit{and} has to be compact and
efficient.

\subsection{Where The Power Goes}
The \qty{5}{\volt} supply powers almost every component in the Game
Gear. This includes the \model{Z80}, both RAM chips, the cartridge,
the VDP, the PSG, the LCD picture conversion circuitry, and even the
florescent tube. Most of these components are just silicon within the
two or one ASIC(s) on the main board. The tube is driven with an AC
inverter and a large transformer, also both on the main board.

The \qty{34}{\volt} supply is used for just one purpose: driving the
actual LCD. I believe the display is a color passive-matrix screen,
and the voltage is needed to bias the screen. Looking at the
\model{VA1} schematic of the main board, on the second sheet, one can
see that the \qty{34}{\volt} supply is connected to a large circuit
block including $VR_1$, which is the contrast control potentiometer.

This means that if, say, you choose to install a new backlight,
\textbf{do not cut the \qty{34}{\volt} line} the way you would for a
complete screen replacement. The original screen always needs it, to
remain functional.

\subsection{Signal and Line Names}
\begin{description}
\item[\Vcc{}] The positive voltage from the 6 batteries or the DC power
  jack. This is ideally \qty{9}{\volt}, but it will vary. Note that
  this is called \texttt{VBAT} on the schematic.
\item[\Vout{}] The final regulated \qty{5}{\volt} output.
\item[\Vref{}] A \qty{1}{\milli{}A} \qty{1.28}{\volt} supply,
  internally generated within the \model{MB3775}.
\end{description}

\section{Power Input Section}
This portion of the schematic is presented in the two dashed boxes at
the top of the \model{VA1} page. On the \model{VA0} page, it is at the
top left (look for $J_1$).

The raw battery line is passed into the main board through the 9-pin
connector. It is filtered (and probably stabilized) beforehand with
$C_{10}$ and $C_{11}$.

\subsection{Batteries and Chemistry}
\label{sec:batteries_chemistry}
For this section, reference the graphs at
\url{https://www.powerstream.com/AA-tests.htm}. The various battery
facts and statistics I state here are from the graphs on this
page. For alkaline AAs, use the \qty{500}{\milli{}A} discharge current
graph. The NiMH graph is at the very bottom of the page.

Input power can come from one of two sources on the Game Gear: a) the
6 AAs, or b) the DC power jack. The AAs are connected in series, for
an optimal voltage of \qty{9}{\volt}.

As in many battery-powered devices, both alkaline and NiMH AAs work
fine. However, NiMH batteries have a voltage profile during discharge
that is nearly flat, until the end of the cycle, where the voltage
drops sharply. This means that while NiMH batteries work in the
console, there isn't much time between when the power LED starts
blinking and when the battery voltage gets so low that the console
can't even turn on.

I have found on my unit that the power LED will usually not even enter
a full blinking mode (see Section \ref{sec:low_voltage}) once NiMH
batteries are low. It starts flashing in the ``not fully off'' mode,
and never reaches the ``fully off'' mode before the whole unit powers
down. This exact behavior is, however, probably dependent on NiMH
battery construction, health, and even brand.

The \model{MB3775} is responsible for turning the console off when
\Vcc{} is beneath \qty{2.5}{\volt} (see Section \ref{sec:scp}). \Vcc{}
is connected to the main board through the power board connector, and
is monitored by the ASIC(s). The power LED is not connected to \Vcc{}
or a regulated output, but to a pin on the main ASIC (either the
larger one or the only one, depending on board revision). This chip is
in control of the power LED, and blinks it once \Vcc{} reaches some
threshold voltage. I suspect that this threshold is around
\qty{5}{\volt}, resulting in a per-cell voltage of about
\qty{0.8}{\volt}. This is close to the voltage of an alkaline AA when
it is close to fully discharged.

% what might be behind that behavior where the whole thing would
% briefly power on if a cartridge wasn't inserted well? That sounds
% like SCP to me.
\subsection{DC Jack Switching}
\label{sec:jack_switching}
Note: this subsection describes the DC jack in an American Game
Gear. For a European model (see Section \ref{sec:plug_dimensions}),
switch the polarities of the jack.

The DC jack, $J_1$, is a particular type of jack known as a
\textit{switched jack}. For convenience, number the pins of the jack
from top to bottom as 1, 2, and 3. Let's also call the positive end of
the batteries \chippin{BT+} and the negative \chippin{BT-}.

When no plug is inserted, pin 3 is connected to \chippin{BT+} through
diode $D_1$, preventing any current from flowing into the DC jack, and
pins 1 and 2 are connected to each other and to \chippin{BT-}. When a
plug is inserted, the connection between pins 1 and 2 is broken. This
leaves pin 2 floating and disconnects the batteries from the circuit,
protecting them from the current supplied by the DC jack. Now, the DC
jack provides \Vcc{}.

This is where the schematic becomes confusing. The \model{VA1}
schematic has pin 1 connected to the battery ground through diode
$D_6$, which is marked with the text ``\texttt{NOT USED}'' beneath
it. If we assume that $D_6$ is not meant to be installed and that DC
jack pin 1 is instead supposed to be directly connected to
\chippin{BT-}, then there's no way the switching feature of the DC
jack is ever used. This is obviously an issue, and isn't explained at
all in the \model{VA1} schematic.

The \model{VA0} schematic clears this up. It doesn't include $D_6$ at
all, nor does it include the connection between DC jack pins 1 and
2. This means that $D_6$ is completely extraneous, likely a remnant
from some old design.

\subsection{Switching While Powered On}
The Game Gear can change power sources from the DC jack to the
batteries (or vice versa) on the fly, while powered on. However, this
causes the power to flicker for long enough that the console resets,
on both plugging in and unplugging the DC plug.

The most likely explanation for this is that the time needed for a
stable connection to be established in the jack \textit{and} for both
the DC supply and the Game Gear to both stabilize is too long for the
switchers in the Game Gear.

The screen doesn't seem to flicker in the same way as it does when the
console is power-cycled, so the \qty{34}{\volt} supply may be more
resilient---perhaps an effect of the gigantic inductor $L_1$.

\subsection{Plug Dimensions and Switch}
\label{sec:plug_dimensions}
An American unit will use the uppermost power input block (labeled
``\texttt{For 120V area}'') on the \model{VA1} schematic. American
units accept a center-positive \qty{1.7}{\milli\meter} inner diameter
by \qty{4.75}{\milli\meter} outer diameter barrel plug.

Europe, of course, uses \qty{240}{\volt} wall power, so a European
unit will use the lower power input block (``\texttt{For AC230V/AC240V
  area}'') on the \model{VA1} schematic, or the only power input
present on the European \model{VA0} schematic. European units accept a
more commonly-sized \qty{2.1}{\milli\meter} inner diameter and
\qty{5.5}{\milli\meter} outer diameter \textbf{center-negative}
plug. Note the difference in polarity between regions.

Japanese Game Gears apparently also use the European plug dimensions
and pinout. See Section \ref{sec:other_sources} for sources on this.

The positive and negative lines are then cleaned with the ferrite
beads $J_V$ and $J_G$. These are visible on the circuit board itself
as the long parallel vertical tubes to the lower right of the
\model{MB3775}.

Finally, the switch will connect \Vcc{} to either ground (when the
system is off) or to the battery/DC jack input. $C_{14}$ will settle
ripples created by the action of the switch turning on. The switch is
vertically flipped on the \model{VA1} schematic, between regions.

\subsection{Input Voltage}
This is an area that is actually very confusing, especially if you're
trying to build your own power cord. The Game Gear case labels the
power jack as \texttt{DC 9V}. The official Game Gear Car Adapter
outputs \qty{9}{\volt}. However, the official Sega wall wart (model
\model{MK-2103}) for the Game Gear is \qty{10}{\volt}. The voltages
don't match---why doesn't this cause a problem?

The exact input voltage doesn't matter too much, within reason,
because the system is designed to tolerate a reasonably wide voltage
range. Here's why it's built that way:

\begin{enumerate}
\item An alkaline AA will only be at \qty{1.5}{\volt} for the first
  few minutes of its life (see Section \ref{sec:batteries_chemistry}),
  at the discharge rate used by the Game Gear. From there, it slowly
  drops. This means that the average input voltage will be about
  $\qty{1.3}{\volt} \times{} 6 = \qty{7.8}{\volt}$. Clearly, this is
  far beneath the optimal \qty{9}{\volt} (or even \qty{10}{\volt}),
  but the console is tolerant and works fine.
\item The \model{MB3775} can operate from \qty{3.6}{\volt} to
  \qty{18}{\volt}. It is designed to significantly adjust the
  switching regulators in response to \Vcc{}, among other factors. If
  it can compensate, and the components it's connected to are
  tolerant, input voltage ends up being of minimal importance within
  reason.
\end{enumerate}

All this is to say that the power circuit is designed to work with a
significant (at least $\pm{}\qty{2}{\volt}$, and probably even
greater) deviation in \Vcc{} voltage. For example, I powered my unit
with \qty{12}{\volt} and it worked perfectly.

There are no electrolytic capacitors connected to \Vcc{}, so it is not
limited by the hazard of driving one with too much voltage.

\subsection{Low Voltage Threshold}
\label{sec:low_voltage}
When the ASIC (or the non-video ASIC in a \model{VA0}) detects low
input voltage, it blinks the red power LED to notify the user. If the
voltage drops even further, the entire console shuts off.

The list below shows the voltages at which this behavior occurs, on my
unit. For this experiment, I built a small adjustable DC supply with a
\model{LM317}, and connected the regulated output to both the DC jack
on my Game Gear and a voltmeter. The initial input voltage was
\qty{10.07}{\volt}, and I turned down the voltage until the console's
behavior changed.

This is what I observed:

\begin{description}
\item[input voltage above \qty{6.8}{\volt}] The LED is fully on.
\item[\qty{6.8}{\volt}--\qty{6.4}{\volt}] The LED blinks, but when it
  is in the ``off'' state, it is not fully off---instead, it is dim
  and flickering.
\item[\qty{6.4}{\volt}--\qty{6}{\volt}] The LED blinks and it is fully
  off in the ``off'' state.
\item[\qty{6}{\volt} and below] The console shuts off completely.
\end{description}

I believe the shutdown below \qty{6}{\volt} is triggered by the
under-voltage lockout. However, as far as I can tell, the
under-voltage lockout is only triggered when \Vcc{} falls beneath
about \qty{2.6}{\volt}, which is obviously much lower than the
\qty{6}{\volt} threshold I observed. I do not know the precise
cause of the shutoff.

% These values were almost surely configured on the basis of an alkaline
% AA's discharge profile (Section \ref{sec:batteries_chemistry}). For
% example, a total input voltage of \qty{6}{\volt} corresponds to
% \qty{1}{\volt} per battery. At a \qty{500}{\milli{}A} discharge rate,
% \qty{1}{\volt} output is just before the battery voltage drops
% rapidly (see the AA discharge graphs). This is probably a safety
% measure, to make sure that the console 

% Note above: at least, I think so. It may be just a result of the uvlo.
\subsection{Compatible Plugs}
I do not have a European Game Gear, but I assume that an Arduino or
similar power supply would work fine, as Arduinos use the same size
power jack. These are very easy to acquire, but make sure the polarity
is correct: an Arduino or similar supply is always center-positive.

For a US Game Gear, I use CUI Devices plug model
\model{PP-014}. DigiKey carries this as part number
\model{CP-014-ND}. It fits and works perfectly.

\section{\model{MB3775} Configuration}
The Fujitsu \model{MB3775PF} ($IC_1$) is the heart of the whole power
board. This chip has two pulse width modulated (PWM) outputs,
short-circuit protection, a wide input voltage range, and low power
consumption. The ``\model{PF}'' suffix indicates a \model{SOP-16}
package. The \model{MB3775} is a switching regulator controller, in
essence a highly configurable PWM generator with an error amplifier,
designed to drive switching regulators of any kind. It is powered
directly from \Vcc{}.

\subsection{Oscillator Timing}
The oscillator timing pins, $C_T$ and $R_T$, are connected to ground
through $C_7$, \qty{680}{\pico\farad} capacitor, and $R_9$, a
\qty{47}{\kilo\ohm} resistor, respectively.

I'm not fully sure what the values of the components on these pins
do. They set the amplitude, frequency, and cycle of the
internally-generated triangular waveform, but there's no simple
equation for the values like there is for other parts of the chip. The
graphs provided in the datasheet are also small and only true for
particular values of $C_T$ and $R_T$, which are not the values used
here.

\subsection{Short Circuit Protection}
\label{sec:scp}
I'm confident that the Game Gear's short circuit protection (SCP) is
actually the heart of a common mistake or rumor: the ASIC(s) on the
main board \emph{do not} protect the console from shorts or power
problems. Instead, the protection is all within the power board, and
basically entirely enclosed in the \model{MB3775}. The SCP circuitry
works like this (don't confuse the SCP circuitry with the
\chippin{SCP} pin):

\begin{enumerate}
\item The outputs of the error amplifiers are connected to the
  non-inverting inputs of the SCP comparator, which checks them
  against an internally-generated \qty{1.1}{\volt} supply connected to
  the inverting input.
\item When the load is stable and not changing, the error amplifier's
  output will not fluctuate (the current draw is steady, and the
  voltage has stabilized). Under this condition, the \chippin{SCP} pin
  is kept at approximately \qty{50}{\milli\volt}.
\item If the load changes drastically due to a short circuit (the
  current becomes very high and resistance goes low), causing a
  voltage below \qty{1.1}{\volt} to be supplied to the non-inverting
  input, the SCP comparator will output a ``low'' signal, switching an
  internal transistor off. This will drop the \chippin{SCP} pin to
  ground, discharging $C_1$ (\qty{50}{\milli\volt} is very little
  voltage, so $C_1$ will discharge rapidly). The SCP comparator will
  then recharge $C_1$ by this formula:

\begin{displaymath}
  V_{PE} = \qty{50}{\milli\volt} + t_{PE} \times
  \frac{10^{-6}}{C_{PE}}
\end{displaymath}

\noindent
where

\begin{displaymath}
  V_{PE} = \qty{0.65}{\volt}, C_{PE} = C_1 = \qty{0.68}{\micro\farad}
\end{displaymath}

($V_{PE}$ is set within the chip) and

\begin{displaymath}
  C_{PE} = \frac{t_{PE}}{\qty{0.6}{\micro\farad}}
  \rightarrow{} t_{PE} = \qty{0.408}{\second}.
\end{displaymath}

\item Once $C_1$ has charged to voltage $V_{PE}$ (which occurs in time
  $t_{PE}$) an internal latch is set. This enables the under-voltage
  lockout circuit, which turns off both output transistors and sets
  the dead time on both outputs to \qty{100}{\%}---together, this
  disables any current to the switchers and saves the load from a
  short.
\item Once the under-voltage lockout is enabled, the protection enable
  is released, but the latch won't reset until power is turned
  off. The chip won't restore power until it's removed and re-applied.
\end{enumerate}

The under-voltage lockout circuit is actually a \emph{different}
feature of the \model{MB3775}, designed to latch and shut off the
outputs if \Vcc{} falls beneath a \qty{2.5}{\volt}
internally-generated reference voltage. The SCP circuitry simply
controls the lockout latch, gaining control over the output of the
entire chip.

Point 1 means that if \emph{either} of the chip's outputs trigger the
short condition, then the entire chip will power down, turning off
both outputs.

Point 4 above means that the SCP comparator will only output the
``low'' signal if the voltage drops beneath \qty{1.1}{\volt} for
$t_{PE} = 0.408$ seconds. To me, this seems like a long time,
especially since the example circuits in the datasheet have
$t_{PE} = \qty{0.06}{\second}$. I suspect it's configured this way so
that the large initial load generated by starting the florescent tube
doesn't trigger the SCP.

% maybe todo: should we discuss the DTC comparator and SCP?
Note: the SCP is really just a simple load monitor. This works because
a short circuit will drastically change the load, and so tuning the
SCP to some desired configuration will allow it to discriminate
between the normal load and an undesired load (like a short circuit, or
a component malfunction).

%I don't know why $C_1$ is tantalum. Possibly to save space on the board.

\subsection{Capacitor ESR}
The \model{MB3775} datasheet warns that electrolytic smoothing
capacitors with low equivalent series resistance (ESR) can create
system instability, by ``increasing phase shift in the high frequency
region'' (datasheet page 24).

The datasheet also says that aluminum electrolytic capacitors have
sufficiently high ESR to prevent this instability from occurring. This
explains why the three electrolytics on the power board are all
through-hole aluminum electrolytic capacitors.

\section{\qty{5}{\volt} Generation}
\subsection{Voltage Setting}
The \qty{5}{\volt} supply is created with the first PWM generator on
the \model{MB3775} and the switching step-down regulator built around
$Q_3$.

The positive input of the error amplifier, \chippin{IN1+}, is
connected to the output of a voltage divider created by $R_{14}$ and
$R_{15}$, creating a feedback loop. This controls the error
amplifier's output, and this output is internally fed into the first
PWM comparator. These two components set the pulse width of the output
PWM wave, controlling the regulator.

The negative input, \chippin{IN1-}, of the amplifier is connected to
\Vref, as described on page 12 of the \model{MB3775} datasheet, creating a
positive voltage on the output pin. The same page of the datasheet
contains this equation, relating the values of the resistors in the
divider to the output voltage:

\begin{displaymath}
  V_0 = V_{ref}\left(1+\frac{R_{15}}{R_{14}}\right) =
  \qty{1.28}{\volt}\left(1+\frac{\qty{20}{\kilo\ohm}}{\qty{6.8}{\kilo\ohm}}\right)
  = \qty{1.28}{\volt}\times{}(1+2.941) = \qty{5.045}{\volt}.
\end{displaymath}

$R_{14}$ and $R_{15}$ are \qty{1}{\%} accuracy resistors, to ensure
that the output voltage from the chip is stable at \qty{5}{\volt} or
very close.

% \texorpdfstring is according to https://tex.stackexchange.com/a/53514

\subsection{Max Duty Cycle}
The max duty cycle is tuned with the \chippin{DTC1} (dead time
control) pin. Page 14 of the datasheet shows that the adjustment is
accomplished with another voltage divider, made with $R_{10}$ and
$R_{11}$, which are $R_a$ and $R_b$ respectively. We find a maximum
duty cycle of

\begin{displaymath}
  \frac{\qty{1}{V} - V_{dt}}{\qty{0.6}{V}}
  \times{} 100 = \qty{109}{\%},
\end{displaymath}

\noindent
given

\begin{displaymath}
  V_{dt} = V_{ref}\left(\frac{R_b}{R_a+R_b}\right) =
  \qty{1.28}{\volt}\left(
  \frac{\qty{12}{\kilo\ohm}}{\qty{33}{\kilo\ohm} +
    \qty{12}{\kilo\ohm}}\right) = \qty{0.341}{\volt},
\end{displaymath}

This sets the max duty cycle to 100\%, with a little bit of
headroom. The \model{MB3775} datasheet says that the max duty cycle
only needs to be set for a step-up regulator, a ``flyback step-up
regulator,'' and an inverting regulator. As the \qty{5}{\volt}
regulator is step-down (see Section \ref{sec:step-down_regulator}),
the max duty cycle is just set to \qty{100}{\%}, bypassing the
functionality.

\subsection{Actual Duty Cycle}
The real duty cycle is dependent on both the input voltage and the
error amplifier, according to datasheet page 15. Assuming an input
voltage of \qty{9}{\volt}, it is
$\frac{V_O}{V_{cc}}\times{}100 = \frac{5}{9}\times{}100 =
\qty{55.6}{\%}$. Of course, the error amplifier and PWM comparator
within the chip will adjust the duty cycle to set the output voltage.

Also note that having the max duty cycle at a value of \qty{100}{\%}
means that the actual duty cycle can technically be anything (though
it will only be \qty{100}{\%} if \Vcc{} is \qty{5}{\volt}). If it were
\qty{100}{\%}, $Q_3$ would always be on, making the voltage difference
across $L_2$ be \qty{0}{\volt}. This would cause $L_2$ to become
effectively a small, high-power resistor. Then the output voltage
would be \qty{5}{\volt}, same as the input.

I think, then, that setting the max duty cycle to \qty{100}{\%} allows
\qty{5}{\volt} to be generated even if \Vcc{} is quite low. If the
\qty{34}{\volt} supply weren't a concern, you could probably power a
Game Gear with \qty{6}{\volt} or even less on \Vcc{}.


\subsection{Error Amplifier Frequency Characteristic}
\label{sec:5v_error_amp_char}
% $C_P$ adjusts the phase compensation of the amp.
This is a feature of the error amplifier that adjusts the roll-off
frequency of the amp. Figure 22 on page 21 of the \model{MB3775}
datasheet shows the feedback pin, \chippin{FB1}, going to ground
through a capacitor $C_P$. For the \qty{5}{\volt} regulator,
$C_P = C_8 = \qty{0.1}{\micro\farad}$. This value is really just a
default, as specified in the datasheet, and it configures the roll-off
frequency of the error amplifier.

Datasheet pages 22 and 23 show how gain and phase are dependent on
both the frequency and the value of $C_P$, and the effects of
different capacitor types. The graphs are too complicated to describe
here.

Note that $C_8$ is marked with a ``\texttt{K}'' on the \model{VA1}
schematic and some text in Japanese on the \model{VA0} schematic. I
think this is some kind of temperature characteristic marking, given
the note on page 21 of the \model{MB3775} datasheet warning about the
importance of the precision of $C_P$. However, ``K'' is not a standard
marking for capacitor temperature tolerance or characteristic. I don't
know exactly what it means.

\subsection{The Step-down Switching Regulator}
\label{sec:step-down_regulator}
The PWM output from the \chippin{OUT1} pin is not enough to actually
make a \qty{5}{\volt} supply. It is meant to be used as the input to
the base of a transistor in a simple step-down switching
regulator. For the \qty{5}{\volt} circuit, the regulator is made out
of $Q_3$, $D_3$, $L_2$, $C_{12}$, and $C_{13}$. It works like this:

\begin{enumerate}
\item When $Q_3$ is on, a linearly increasing current will flow
  through $L_2$. The load is supplied with regulated \qty{5}{\volt}
  and capacitor $C_{13}$ is charged.
\item When $Q_3$ is off, the current present in $L_2$ will attempt to
  flow in the same direction it was before. This will force the end of
  the inductor connected to the cathode of $D_3$ to begin dropping
  below \qty{0}{\volt}. Once the voltage is below \qty{-0.6}{\volt}
  (one diode drop), the diode becomes forward biased and the circuit
  is complete again. Current can flow from both the inductor and the
  capacitor into the load.
\end{enumerate}

$D_3$ is a Hitachi \model{HRF22} Schottky diode. While Schottky diodes
have low forward voltage, they are also able to switch very fast
($\approx{}\qty{100}{\pico\second}$). This allows the diode's bias to
change as quickly as possible once the voltage from $L_2$ changes.

$C_{13}$ is present to reduce the voltage ripple caused by the
constant charging and discharging of $L_2$. This explains why it is so
large: it has to be able to continue powering a large load while the
inductor is discharging, during the time $Q_3$ is off.

Finally, the small size of $C_{12}$ makes it seem irrelevant next to
$C_{13}$. I believe it is present to reduce very small ripples, which
would be far too small to be absorbed by $C_{13}$.

\subsection{$Q_3$ submodel}
\label{sec:q3_submodel}
On both schematics, $Q_3$ has a note that says ``\texttt{ZQ or ZP}.''
This is the submodel of the transistor---i.e., either a
\model{2SC1301ZQ} or a \model{2SC1301ZP}, and it controls the $h_{FE}$
range of the particular unit. A \model{ZQ} unit will have an $h_{FE}$
range of 200 to 400, and a \model{ZP} unit will have an $h_{FE}$
range of 300 to 600. This constraint is present to make sure that
there will be enough current out of the collector ($I_C =
I_Bh_{FE}$). The one other submodel is the \model{ZR}, which has an
$h_{FE}$ range of 135--270. Using Section \ref{sec:current_draw}, I
assume that \qty{300}{\milli{}A} is drawn from the \qty{5}{\volt}
rail. The upper limit of $h_{FE} = 270$ for the \model{ZR} model
might not be enough to power the whole of the \qty{5}{\volt} rail, so
only the models with higher $h_{FE}$ are used.

\section{\qty{34}{\volt} Generation}
The \qty{34}{\volt} supply is low-current DC, used only to power the
LCD. It is created with a step-up switching regulator, the inverse of
the \qty{5}{\volt} step-down regulator.

Each component here is configured in the same way, albeit with
different values, as the \qty{5}{\volt} circuit. See that section for
specifics on each piece of the puzzle.

\subsection{Voltage Setting}
$R_7$ and $R_8$ control the output voltage in a fashion identical to
that of the \qty{5}{\volt} circuit, though with different values:

\begin{displaymath}
  V_0 = V_{ref}\left(1+\frac{R_7}{R_8}\right) =
  \qty{1.28}{\volt}\left(1+\frac{\qty{110}{\kilo\ohm}}{\qty{4.3}{\kilo\ohm}}\right)
  = \qty{34.024}{\volt}
\end{displaymath}

\subsection{Max Duty Cycle}
As this is a step-up regulator, the max duty cycle should be
configured to something beneath \qty{100}{\%} (see Section
\ref{sec:34v_actual_duty_cycle}). It is set to

\begin{displaymath}
  \frac{\qty{1}{\volt} - V_{dt}}{\qty{0.6}{\volt}} \times{} 100 = \qty{70.67}{\%}
\end{displaymath}

\noindent
where

\begin{displaymath}
  R_a = R_1 = \qty{33}{\kilo\ohm},R_b = R_2 = \qty{27}{\kilo\ohm}
\end{displaymath}

\noindent
and

% according to the datasheet, a Vdt of 0.576 V will satisfy the "if no
% output duty setting is required" condition. however, this makes no
% sense, as the graph on the next page shows that Vdt=0.576 V will
% result in about 78% max duty cycle.
\begin{displaymath}
  V_{dt} =  V_{ref}\left(\frac{R_b}{R_a+R_b}\right) =
  \qty{1.28}{\volt}\left(\frac{\qty{27}{\kilo\ohm}}{\qty{33}{\kilo\ohm} +
      \qty{27}{\kilo\ohm}}\right) = \qty{0.576}{\volt}.
\end{displaymath}

Note: page 14 of the \model{MB3775} datasheet says that ``if no output
duty setting is required,'' then ``the voltage'' (presumably the
voltage on \chippin{DTC2}, though it's rather ambiguous) should be set
higher than \qty{1.3}{\volt}, or $V_{dt} > \qty{0.4}{\volt}$. However,
$V_{dt} = \qty{0.576}{\volt}$ is clearly higher than \qty{0.4}{\volt},
but the \qty{34}{\volt} output definitely has a specific output duty
setting. The datasheet itself even has a graph on page 15 that shows
the max duty cycle to be about \qty{70}{\%} when
$V_{dt} = \qty{0.576}{\volt}$.

I don't know exactly what ``no output duty setting'' is, but I presume
that that it sets the duty cycle to \qty{100}{\%}, under any
condition. I think the datasheet contradicts itself here.

\subsection{Actual Duty Cycle}
\label{sec:34v_actual_duty_cycle}
Using the second equation from datasheet page 15, we find the actual
duty cycle to be
$\frac{V_O - V_{cc}}{V_O} \times{} 100 = \frac{\qty{34}{\volt} -
  \qty{9}{\volt}}{\qty{34}{\volt}} \times{} 100 = \qty{73.5}{\%}$,
given a \Vcc{} of \qty{9}{\volt}.

% If Vcc drops beneath about 8 volts, the duty cycle will be above the
% max. In this case, it will stay fixed at 70.67%.

% Datasheet says that in voltage step-up configuration, the voltage on
% the FB pin may go lower than the triangular wave voltage. This will
% trigger the output transistor to be fully on. This would cause
% the current through L1 to increase, but never discharge, and so
% the high-voltage boost is never generated.

The max duty cycle is important for this regulator, unlike the
\qty{5}{\volt} regulator. According to the \model{MB3775} datasheet
(page 14), it is possible for the feedback pin (\chippin{FB2}) of the
error amplifier to go below the voltage of the internally-generated
triangular wave (the feedback pin is connected to the error amplifier
output within the chip). This causes the chip's output transistor to
stay switched on, and keeps $Q_1$ and $Q_2$ switched on as well. When
this happens, $L_1$ is never discharged, and the boosted output
voltage is not generated.

This condition could also be created by a low \Vcc{}.
\subsection{Error Amplifier Frequency Characteristic}
$C_3$ is identical to $C_8$ (see Section \ref{sec:5v_error_amp_char}).

\subsection{Soft Start Time}
\label{sec:soft_start_time}
The soft start time for the \qty{34}{\volt} half of the chip is set
with $C_2$, a \qty{0.1}{\micro\farad} capacitor. The large equation
from page 16 of the datasheet gives

\begin{displaymath}
  V_{cc}\left(\frac{-C_2R_aR_b}{R_a+R_b}\right)\left(\frac{1-0.7(R_a+R_b)}{1.28R_a}\right)
  = \qty{0.013}{\second}.
\end{displaymath}

\noindent
where
\begin{displaymath}
  C_2 = \qty{0.1}{\micro\farad},R_a =
  \qty{33}{\kilo\ohm},R_b=\qty{27}{\kilo\ohm},V_{cc} = \qty{9}{\volt}.
\end{displaymath}

The soft start time is the time from power-on until the duty cycle
reaches \qty{50}{\%}. Configuring it causes the chip to slowly
increase the duty cycle during $t_{PE}$, minimizing the amount of
initial current drawn by the switcher. At \qty{34}{\volt}, an inductor
as large as $L_1$ draws a lot of current when it starts from 0, so the
soft start is a protection measure.

This has two effects on the circuit:

\begin{enumerate}
\item The \qty{5}{\volt} regulator will be fully functional before the
  \qty{34}{\volt} regulator is. The status of the \qty{5}{\volt}
  regulator isn't important except that $L_1$ is connected to $Q_3$'s
  base, so the output of the \qty{34}{\volt} supply is dependent on
  the \qty{5}{\volt} supply already running and stable.
\item A slow startup will allow the current drawn by the
  \qty{34}{\volt} regulator to ramp up slowly, so that there is
  minimal voltage drop on \Vcc{}. This ensures that the circuit isn't
  starved for voltage on power-on.
\end{enumerate}

The \qty{5}{\volt} regulator has a configured soft start in the
\model{VA0} schematic, but not in the \model{VA1} schematic. I think
it was removed because $L_2$ isn't very big, so charging it doesn't
pose a threat to the voltage of \Vcc{} on startup (even if the load
from the regulator does).

\subsection{The Step-up Switching Regulator}
\label{sec:step-up_regulator}
$Q_1$, $Q_2$, $L_1$, $D_2$, $C_4$, and $C_5$ (plus $R_3$, $R_4$,
$R_5$, and $R_6$) create the \qty{34}{\volt} step-up switching
regulator, and it is very similar to the second example circuit on
page 10 of the \model{MB3775} datasheet. $Q_1$ and $Q_2$ are
controlled by the PWM output of the \model{MB3775}, on pin
\chippin{OUT2}. The step-up switcher works like this:

\begin{enumerate}
\item When $Q_1$ and $Q_2$ are on, the voltage at the anode of $D_2$
  is \qty{0}{\volt}, because it's connected to ground through
  $Q_2$. The voltage difference across $L_1$ then charges $L_1$,
  causing the current in the coil to increase. During this time, only
  current stored in $C_5$ is delivered to the load.
\item When the two transistors turn off, $L_1$'s decreasing current
  increases the voltage on the anode of $D_2$, causing it to become
  forward biased. Current from both $L_1$ and $C_5$ is delivered to
  the load.
\end{enumerate}

All in all, this makes a smooth and steady high-voltage supply. Like
in the \qty{5}{\volt} regulator, the small ceramic $C_4$ is present to
reduce small ripples. $D_2$ is identical to $D_1$ (see Section
\ref{sec:step-down_regulator}), for fast switching.

One oddity of this regulator is that it uses two transistors, as
opposed to one, like a normal step-up switcher design does. The
reasoning for this is simple. Page 4 of the datasheet shows the block
diagram of the \model{MB3775}, and shows that \chippin{OUT1} and
\chippin{OUT2} are \textit{open collector outputs}, meaning that they
are connected to the collector of an NPN transistor (these transistors
are the same as those controlled by SCP). The emitter of those
transistors is connected to ground, and the base is connected to the
switching circuitry.

If $Q_1$ weren't present, for example, and the collector of $Q_2$ was
connected directly to \chippin{OUT2}, then no current would ever
flow. When the transistor inside the chip turns on, \chippin{OUT2} is
connected to ground. This would enable $Q_2$, connecting its collector
to ground, along with $L_1$ and $D_3$. The entire switcher would just
connect ground to ground, serving no purpose.

Using a PNP transistor ($Q_1$) allows current to flow when
\chippin{OUT2} goes to ground. When this happens, current will flow
from the emitter to the base of $Q_2$, switching $Q_2$ on. Current
will also flow from $Q_2$'s emitter to its collector, switching $Q_2$
on and enabling the switcher.

This is also why the \qty{5}{\volt} supply also uses a PNP
transistor. It's a simple way (and possibly the only way) to use the
switching provided by the chip.

Finally, $Q_1$ and $Q_2$ are complementary models (\model{2SA812} and
\model{2SC1623}), so they share maximum voltage, electrical
characteristics, and current gain. This is simply for consistency.

\subsection{$L_1$ and the \qty{5}{\volt} Supply}
\label{sec:l1_and_5v}
One choice in the design on this circuit, that seems odd at first
glance, is that $L_1$ is connected to the collector of $Q_3$, on the
\qty{5}{\volt} switcher but before the switcher coil or
capacitors. Most switching regulators, including the second
\model{MB3775} example circuit (see Section
\ref{sec:step-up_regulator}), have the coil connected to \Vcc{}.

This is clearly not because of some current limitation---just as much
current could be drawn straight from the batteries. It is also almost
surely not for some kind of synchronization, as each regulator runs at
a different duty cycle \textit{and} the soft start time will offset
the \qty{34}{\volt} regulator.

The only explanation I can think of is that the voltage out of $Q_3$'s
collector is always lower than \Vcc{}, so $L_1$ will never be
overcharged. In fact, this adds to the reasoning behind the soft start
time: the \qty{5}{\volt} supply has to be fully operational before the
\qty{34}{\volt} supply begins regulating.

Now, the \qty{34}{\volt} must never rise very much \textit{anyway},
since $C_5$ is only rated for \qty{35}{\volt}.

% What I worry is that this is something far more complicated, perhaps
% some form of phase compensation or alignment. There are reasons I've
% figured out in the past that make it seem unlikely, but I'm sure I'm
% not considering everything.
\section{Current Draw}
\label{sec:current_draw}
My particular unit, which is a stock \model{US VA1 837-9024} (except
for a recap) draws about \qty{330}{\milli{}A} total when powered by a
\qty{9}{\volt} wall supply. I think most of this current is actually
drawn by the tube, and that the other components and circuitry do not
draw much current.

For the purposes of the estimates in this section, I assume that
\qty{300}{\milli{}A} is drawn by the \qty{5}{\volt} rail, though I
have no evidence for this value.

$Q_3$ has a maximum collector current of \qty{-3}{A}. Even if all
\qty{330}{\milli{}A} were on just the \qty{5}{\volt} line ($Q_3$'s
collector), there would still be over \qty{2.5}{A} of leeway for other
things to draw current from the \Vout{} line.

The specific value of $h_{FE}$ doesn't matter. The transistor will
change the base current in response to the collector current
($I_C=h_{FE}I_B$), and the output transistors (see Section
\ref{sec:step-up_regulator}) in the \model{MB3775} are capable of
sinking up to \qty{50}{\milli{}A}.

To prove $h_{FE}$ isn't an issue, assume that $Q_3$ has an $h_{FE}$
that is the minimum for the model, 200 (see Section
\ref{sec:q3_submodel}).  We find that the \textit{minimum} collector
current on $Q_3$ when the chip is sinking only \qty{10}{\milli{}A} is
$200\times{}\qty{10}{\milli{}A}=\qty{2}{A}$. Therefore, $h_{FE}$ is
not a current limitation on $Q_3$, because the \model{MB3775} is
capable of sinking so much current.

It's also probably not a good idea to draw from the \qty{34}{\volt}
supply. Transistors $Q_1$ and $Q_2$ have a maximum collector current
of \qty{-100}{\milli{}A} and \qty{100}{\milli{}A}, respectively
(though again, $h_{FE}$ isn't creating a current limit). This
comparatively small limit means that there probably isn't much space
to draw more current (and converting \qty{34}{\volt} to something more
useful is difficult anyway).

There's also some risk in drawing too much current from the batteries
or the DC jack. The average alkaline AA is only designed for an
extended maximum current draw of about \qty{1}{A}
(\url{https://www.eevblog.com/forum/projects/maximum-aa-battery-current-draw/}.
Even with less current draw than this, the batteries will likely start
heating up, which isn't safe for anything involved. Also, if you draw
too much power from a wall wart, you could damage it too.

Finally, drawing more current will reduce the battery life to
something even more measly.

\section{Documents and Sources}
\label{sec:documents}
\subsection{Datasheets}
\begin{description}
\item[\model{MB3775} ($IC_1$)]
  \url{https://console5.com/techwiki/images/2/24/MB3775.pdf}
\item[\model{FBA04VA450AB-00} ($J_V,J_G$)]
  \url{https://www.mouser.com/datasheet/2/396/leaded_i04_e-2307117.pdf}
\item[\model{2SA812} ($Q_1$)]
  \url{https://www.electrokit.com/uploads/productfile/41017/2SA812.pdf}
\item[\model{2SA1623} ($Q_2$)]
  \url{https://www.mouser.com/datasheet/2/258/2SC1623(SOT-23)-276330.pdf}
\item[\model{2SB1301} ($Q_3$)]
  \url{https://www.renesas.com/us/en/document/dst/2sb1301-data-sheet}
\item[\model{U1BC44} ($D_1$)]
  \url{https://toshiba.semicon-storage.com/info/docget.jsp?did=3193&prodName=U1BC44}
  
\item[\model{HRF22} ($D_2,D_3$)]
  \url{https://datasheet.datasheetarchive.com/originals/distributors/Datasheets-316/565268.pdf}
\end{description}

\subsection{Schematics}
\label{sec:documents_schematics}
I think Console5 is the best source for schematics. The schematics
below are the ones you want if you're just going to be following along
with this document:
\begin{description}
\item[European \model{VA0}]
  \url{https://console5.com/techwiki/images/2/22/Game_Gear_VA0_Schematic_-_Power.png}
\item[Any region \model{VA1}]
  \url{https://console5.com/techwiki/images/8/87/Game_Gear_VA1_Schematic_-_DC-DC_and_Sound.png}.
\end{description}

Unfortunately, I know of no scans of schematics for any other model
(\model{VA4}, \model{VA5}, or Majesco). However, the minimal variation
between the \model{VA0} and \model{VA1} schematics suggests that there
are likely few changes in the later hardware revisions as well.

The European \model{VA0} document is not very readable, as it appears
to have been hand-drawn. It also has some extra components, like
$R_{18}$ and $R_{19}$ (and others), that aren't present in the
\model{VA1} schematic. It also has a capacitor, $C_9$, to set the soft
start time for the \qty{5}{\volt} generator.

Other schematics, for the main and sound boards (also only \model{VA0}
and \model{VA1}), are at
\url{https://console5.com/wiki/Game_Gear#Schematics}.

The \model{VA1} documents are printed in a font that doesn't seem to
scale well. These are the ones I had the most trouble reading:

\begin{description}
\item[$D_1$] A Toshiba \model{U1BC44} diode.
\item[$C_{13}$] A \qty{820}{\micro\farad} \qty{5.3}{\volt}
  electrolytic capacitor.
  
\item[$J_V$ and $J_G$] A pair of \model{FBA04VA450AB-00}
  \qty{3.5}{\milli\meter} \qty{45}{\ohm} ferrite beads. The way the
  schematic is laid out, it suggests that $J_V$ is a different part,
  but the tiny ``\texttt{*2}'' indicates that $J_V$ and $J_G$ are the
  same.
\end{description}

\subsection{Useful Documents}
TI hosts an excellent document explaining switching regulators:
\url{https://www.ti.com/lit/an/snva559c/snva559c.pdf}.

This is a good explanation of what a soft-start feature is good for:
\url{https://www.electronicdesign.com/power-management/article/21801244/simple-softstart-circuitry-provides-long-startup-times}.

Analog Devices also has a good discussion of switchers:
\url{https://www.analog.com/en/technical-articles/upper-end-limits-duty-cycle.html}.

\subsection{Other Sources}
\label{sec:other_sources}
Data on Sega power supplies comes from images on Sega Retro
(\url{https://segaretro.org}).

This Stack\-Ex\-change answer explains switched jacks very well:
\url{https://electronics.stackexchange.com/a/90531}.

I don't own a European unit, and I cannot seem to find the website I
saw that said it was a 2.1/5.5 plug. However, I am confident that I
remember it correctly.

There are many sources for the dimensions of each region's DC
plug. Google ``game gear power jack dimensions'' and you'll find one
like this:
\url{https://www.reddit.com/r/game_gear/comments/gh6psb/what_polarity_is_the_gg_power_adapter}.

Information on LCD bias voltage comes from
\url{http://www.hantronix.com/files/down/neg-invr.pdf} and
\url{https://www.pacificdisplay.com/lcd_multiplex_drive.htm}.
\section{Remaining Questions}
\label{sec:remaining_questions}
\begin{itemize}
\item What are the effects of the biasing placed on each transistor?
  It is related to the current that flows into the base when the
  chip's outputs are off, but how?
\item How are $C_7$ and $R_9$ controlling the oscillator?
\item Why is $t_{PE}$ so long? Just to accommodate a large load?
\item Why is $C_1$ tantalum?
\end{itemize}

\section{Revision History}
\begin{description}
\item[v1.0, July 2021] First release.
\item[v1.1, September 2021] Added information on running a Game Gear
  at \qty{12}{\volt}, and added the section on the low voltage thresholds.
\end{description}
\end{document}
